# 9. Нефункциональные требования

## 9.1. Производительность (Performance)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Время отклика API** | 95-й перцентиль времени ответа критических API (получение ленты, сохранение тренировки) не должен превышать указанных значений. | p95 < 500 мс для синхронных запросов. Фоновые операции (импорт, обработка) — асинхронно. |
| **Пропускная способность** | Система должна выдерживать пиковые нагрузки во время массовых мероприятий (челленджи, соревнования). | Не менее 10 000 запросов в секунду на API Gateway. |
| **Время загрузки приложения** | Время до первого взаимодействия (TTI) для мобильных приложений. | Не более 2 секунд на соединении 3G. |
| **Скорость обработки GPS-треков** | Время от завершения тренировки до появления её в истории и обновления статистики. | Не более 5 секунд для 95% тренировок. |
| **Обновление рейтингов в реальном времени** | Задержка обновления позиций в лидербордах во время соревнований. | Не более 2 секунд. |

## 9.2. Надежность и отказоустойчивость (Reliability & Fault Tolerance)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Доступность системы (SLA)** | Процент времени, в течение которого система доступна для пользователей. | 99.9% в течение года (не более 8,5 часов простоя в год). Для критических сервисов (User, Workout, API Gateway) — 99,95%. |
| **Восстановление после сбоев (RTO)** | Время, необходимое для восстановления работоспособности после аварии. | RTO не более 4 часов для некритических компонентов, не более 1 часа для критических. |
| **Целостность данных (RPO)** | Максимально допустимая потеря данных при сбое. | RPO не более 5 минут (репликация и резервное копирование с такой частотой). |
| **Устойчивость к сбоям внешних систем** | При недоступности интеграций (носимые устройства, e-commerce) система должна продолжать работу (с ограничением функциональности). | Graceful degradation, кэширование данных, повторные попытки. |
| **Резервное копирование** | Регулярное резервное копирование баз данных и объектного хранилища. | Ежедневное полное копирование, непрерывное или частное инкрементальное. Хранение не менее 30 дней. |

## 9.3. Безопасность (Security)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Аутентификация и авторизация** | Доступ к API только после успешной аутентификации. Использование JWT, OAuth2. Разграничение прав пользователей и администраторов. | Соответствие OWASP рекомендациям, отсутствие критических уязвимостей. |
| **Шифрование данных** | Все данные, передаваемые по сети (внешней и внутренней), должны шифроваться (TLS 1.2+). Данные в покое шифруются (базы данных, объектное хранилище). | Использование AES-256 для хранилищ, TLS 1.3 рекомендуется. |
| **Защита персональных данных** | PII (персональные данные) должны храниться с дополнительными мерами защиты (псевдонимизация, ограниченный доступ). | Соответствие GDPR, CCPA. Регулярный аудит доступа. |
| **Управление согласиями (Consent Management)** | Пользователь должен явно соглашаться на сбор и обработку данных. Возможность отозвать согласие. | Реализация механизма consent, логирование согласий. |
| **Безопасность кода** | Регулярное сканирование кода на уязвимости (SAST, DAST). Процесс безопасной разработки (SDL). | Отсутствие критических уязвимостей в production. |
| **Защита от DDoS** | Система должна выдерживать DDoS-атаки на уровне инфраструктуры. | Использование облачных средств защиты (AWS Shield, Cloudflare), rate limiting на API Gateway. |

## 9.4. Масштабируемость (Scalability)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Горизонтальное масштабирование** | Все сервисы должны быть спроектированы для горизонтального масштабирования (stateless, возможность добавления экземпляров). | Автомасштабирование в Kubernetes (HPA) на основе нагрузки. |
| **Масштабирование баз данных** | Базы данных должны поддерживать шардинг, репликацию для чтения. | Возможность добавления узлов без остановки сервиса. |
| **Пиковая нагрузка** | Система должна выдерживать увеличение нагрузки в 5 раз от средней в течение 15 минут (сценарий массового мероприятия). | Автоматическое масштабирование, использование очередей для сглаживания пиков. |
| **Глобальное присутствие** | Возможность развертывания в нескольких географических регионах для снижения задержек и соблюдения data residency. | Поддержка мультирегиональной инфраструктуры (Kubernetes clusters в разных облаках/регионах). |

## 9.5. Наблюдаемость (Observability)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Логирование** | Централизованный сбор логов от всех сервисов. Логи должны содержать идентификаторы запросов (correlation ID). | Использование ELK/EFK стека. Хранение логов не менее 30 дней. |
| **Метрики** | Сбор системных метрик (CPU, память, сеть) и бизнес-метрик (количество тренировок, активные пользователи). Настройка алертов. | Prometheus + Grafana, оповещения в мессенджеры/email. |
| **Трассировка** | Распределённая трассировка запросов, проходящих через несколько сервисов. | Jaeger или Zipkin, охват не менее 90% трафика (с сэмплированием). |
| **Дашборды** | Наличие дашбордов для разработчиков, DevOps и бизнес-аналитиков. | Графана с предустановленными панелями. |

## 9.6. Удобство сопровождения (Maintainability)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Документирование API** | Все API должны быть документированы в формате OpenAPI (Swagger). | Автоматическая генерация документации, доступность через API Gateway. |
| **Кодовая база** | Единые стандарты кодирования, наличие комментариев, прохождение код-ревью. | Статические анализаторы (SonarQube) в CI/CD. |
| **Тестируемость** | Наличие юнит-тестов, интеграционных тестов, e2e-тестов. Покрытие кода не менее 80%. | Автоматизированные тесты в CI/CD. |
| **Управление конфигурацией** | Конфигурация сервисов должна храниться в централизованном хранилище (etcd, Consul, Kubernetes ConfigMaps) с версионированием. | — |
| **Возможность отката** | Поддержка rolling updates и отката версий без длительного простоя. | Использование стратегий деплоя (blue-green, canary). |

## 9.7. Интернационализация и локализация (i18n & L10n)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Поддержка языков** | Приложение должно поддерживать несколько языков интерфейса. Стартовый набор: английский, испанский, китайский, немецкий, французский. | Возможность добавления новых языков без изменения кода (внешние файлы переводов). |
| **Форматы дат, времени, чисел** | Локализация форматов в зависимости от региона пользователя. | Использование стандартных библиотек локализации. |
| **Контент и промо** | Возможность показывать контент и промо на локальном языке, с учётом местных праздников и событий. | Региональные настройки в Promo Service. |

## 9.8. Соответствие регуляциям (Compliance)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **GDPR (Европа)** | Полное соответствие требованиям GDPR: право на забвение, согласие на обработку, уведомление об утечках, защита данных по умолчанию. | Реализация механизмов удаления данных, экспорта данных, согласий. |
| **CCPA (Калифорния)** | Соответствие требованиям CCPA: право знать, право удалить, отказ от продажи данных. | Аналогично GDPR, с учётом особенностей. |
| **Локальные законы** | Для стран с особыми требованиями (Бразилия, Япония и др.) возможность адаптации. | Модульная архитектура, позволяющая добавлять региональные правила. |
| **Сертификации** | Получение сертификатов безопасности (ISO 27001, SOC 2) в перспективе. | Проектирование с учётом требований этих стандартов. |

## 9.9. Совместимость (Compatibility)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Мобильные платформы** | Поддержка iOS (начиная с версии 14) и Android (начиная с API 26). | Регулярное тестирование на актуальных устройствах. |
| **Носимые устройства** | Поддержка интеграции с популярными брендами: Garmin, Polar, Apple Watch, Fitbit, Xiaomi. | Использование SDK производителей или облачных API. |
| **Фитнес-платформы ОС** | Интеграция с Apple HealthKit и Google Fit для импорта/экспорта данных. | Реализация двусторонней синхронизации. |
| **Веб-браузеры** | Поддержка последних версий Chrome, Firefox, Safari, Edge. | Адаптивный дизайн, PWA. |

## 9.10. Требования к данным и хранению

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Срок хранения данных** | Пользовательские данные (тренировки, профиль) хранятся бессрочно, пока пользователь не удалит аккаунт. Логи и события аналитики хранятся ограниченное время. | Логи — 30 дней, сырые события аналитики — 90 дней, агрегаты — дольше. |
| **Резервное копирование** | Ежедневное резервное копирование баз данных и объектного хранилища. Хранение копий в другом регионе. | Тестирование восстановления не реже раза в квартал. |
| **Data residency** | Данные пользователей из определённых регионов (EU, Россия и др.) должны храниться на территории этого региона. | Возможность выбора региона для хранения при развёртывании. |

## 9.11. Юзабилити (Usability)

| Требование | Описание | Целевое значение / Критерий |
|------------|----------|------------------------------|
| **Простота использования** | Интерфейс должен быть интуитивно понятен для разных возрастных групп. | Тестирование с пользователями, оценка по шкале SUS не ниже 80. |
| **Адаптивность** | Приложение должно корректно отображаться на разных размерах экранов (телефоны, планшеты). | Поддержка всех основных разрешений. |
| **Доступность (Accessibility)** | Соответствие стандартам доступности WCAG 2.1 (уровень AA). | Поддержка VoiceOver/TalkBack, достаточный контраст, масштабирование текста. |

Эти нефункциональные требования будут служить основой для проектирования архитектуры, выбора технологий и дальнейшей разработки. Они также будут уточняться и дополняться на последующих этапах.
# 8. Атрибуты качества (основные)

В соответствии с бизнес-целями и техническими требованиями выделены три ключевых атрибута качества, которым будет уделено первостепенное внимание при проектировании и разработке системы. Остальные атрибуты (производительность, надёжность, модифицируемость и др.) также важны, но рассматриваются как производные или обеспечиваемые через реализацию основных.

## 8.1. Масштабируемость (Scalability)

**Определение:** Способность системы обрабатывать растущую нагрузку (количество пользователей, тренировок, событий) без деградации производительности, а также выдерживать пиковые нагрузки (например, во время массовых соревнований).

**Обоснование важности:**
- Приложение ориентировано на глобальную аудиторию (миллионы пользователей).
- Планируются массовые мероприятия (челленджи, соревнования) с резким всплеском активности.
- Система должна расти вместе с бизнесом без необходимости кардинальной перестройки.

**Ключевые требования:**
- Горизонтальное масштабирование микросервисов.
- Масштабирование баз данных (шардирование, репликация).
- Эффективное использование кэширования и CDN.
- Автомасштабирование инфраструктуры (Kubernetes HPA).
- Асинхронная обработка для сглаживания пиков (очереди).

**Метрики:**
- Время отклика API при росте нагрузки (SLO: p95 < 500 мс).
- Количество одновременно активных пользователей, которое может обслуживать система.
- Скорость обработки событий (событий/сек).

## 8.2. Безопасность и приватность (Security & Privacy)

**Определение:** Обеспечение конфиденциальности, целостности и доступности данных, защита от несанкционированного доступа, а также выполнение требований регуляторов (GDPR, CCPA и др.) в отношении персональных данных пользователей.

**Обоснование важности:**
- Приложение обрабатывает чувствительные данные: геолокация, медицинские показатели (пульс, кислород), персональная информация.
- Нарушение безопасности приведёт к потере доверия, юридическим санкциям и финансовым потерям.
- Разные страны имеют различные законы о хранении и обработке данных (data residency).

**Ключевые требования:**
- Шифрование данных в покое и при передаче (TLS, AES-256).
- Аутентификация и авторизация (JWT, OAuth2, SSO).
- Управление доступом на основе ролей (RBAC) для администраторов.
- Система управления согласиями (consent management) и возможность удаления данных.
- Аудит доступа к данным.
- Регулярные пентесты и сканирование уязвимостей.
- Региональное хранение данных в соответствии с законами.

**Метрики:**
- Отсутствие критических уязвимостей по результатам пентестов.
- Время реакции на инциденты безопасности.
- Количество нарушений приватности (целевое — 0).

## 8.3. Наблюдаемость (Observability)

**Определение:** Способность измерять внутреннее состояние системы по внешним данным (логи, метрики, трассы), позволяющая операторам и разработчикам понимать, что происходит, быстро выявлять и диагностировать проблемы, а также анализировать поведение пользователей.

**Обоснование важности:**
- Распределённая микросервисная архитектура сложна для отладки.
- Необходимо быстро реагировать на сбои, чтобы минимизировать влияние на пользователей.
- Бизнес требует глубокой аналитики использования для принятия решений.
- Наблюдаемость — основа для обеспечения других атрибутов (масштабируемость, безопасность) через мониторинг.

**Ключевые требования:**
- Централизованный сбор логов (ELK/EFK).
- Сбор метрик (Prometheus, Grafana) с оповещениями.
- Распределённая трассировка (Jaeger, Zipkin) для отслеживания запросов между сервисами.
- Мониторинг бизнес-метрик (DAU, количество тренировок, конверсии).
- Дашборды для разных ролей (разработчики, DevOps, бизнес).

**Метрики:**
- Время обнаружения инцидента (MTTD).
- Время восстановления (MTTR).
- Полнота сбора трассировок (процент запросов с трассировкой).
- Доступность дашбордов для ключевых метрик.

## 8.4. Компромиссы между атрибутами качества

| Компромисс | Описание | Архитектурные решения для баланса |
|------------|----------|-----------------------------------|
| **Масштабируемость vs Безопасность** | Меры безопасности (шифрование, детальный аудит, проверки) могут снижать производительность и усложнять масштабирование. | • Использование аппаратного ускорения шифрования.<br>• Асинхронный аудит (пишем события аудита в очередь).<br>• Многоуровневая безопасность: на периметре (API Gateway) и внутри сервисов.<br>• Выбор облачных провайдеров с сертификациями безопасности. |
| **Масштабируемость vs Наблюдаемость** | Сбор детальных логов и трассировок генерирует огромный объём данных, который сам может стать узким местом и увеличить затраты. | • Выборочный сбор трассировок (sampling).<br>• Агрегация метрик на стороне сервисов (не отправлять каждое событие).<br>• Использование масштабируемых хранилищ для логов (ClickHouse, Loki).<br>• TTL для данных наблюдения. |
| **Безопасность vs Наблюдаемость** | Логи могут содержать чувствительные данные, что создаёт дополнительные риски утечки. С другой стороны, для расследования инцидентов нужны детальные логи. | • Маскирование и обезличивание чувствительных данных в логах.<br>• Разграничение доступа к логам.<br>• Хранение логов в зашифрованном виде.<br>• Использование инструментов PII detection. |
| **Производительность (часть масштабируемости) vs Приватность** | Сильная привязка данных к региону (data residency) может увеличить задержки, если пользователь перемещается, а его данные «закреплены». | • Кэширование на граничных узлах.<br>• Проектирование с учётом глобальных идентификаторов и локальных реплик.<br>• Использование глобальных балансировщиков с учётом задержек. |

## 8.5. Заключение

Выбранные три атрибута — масштабируемость, безопасность/приватность и наблюдаемость — являются взаимосвязанными и определяющими для успеха системы. Архитектура строится так, чтобы обеспечить их сбалансированное развитие, осознавая и управляя компромиссами. На последующих этапах будут детализированы конкретные механизмы достижения требуемых уровней по каждому атрибуту.
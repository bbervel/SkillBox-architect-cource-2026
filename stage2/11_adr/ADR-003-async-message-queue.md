# ADR-003: Асинхронное взаимодействие через очереди сообщений

## Статус
Принято

## Контекст
В микросервисной архитектуре необходимо обеспечить взаимодействие между сервисами. Часть операций требует немедленного ответа (синхронные), другие могут обрабатываться асинхронно (уведомления, обновление поисковых индексов, аналитика). Также нужно сглаживать пиковые нагрузки.

## Рассмотренные альтернативы
1. **Только синхронные вызовы (HTTP/REST/gRPC)**.
2. **Только асинхронные сообщения**.
3. **Гибридный подход** — синхронные вызовы для критических операций, асинхронные для фоновых задач.

## Решение
Использовать гибридный подход:
- Синхронные вызовы (REST) для операций, требующих немедленного ответа.
- Асинхронные события через Kafka/RabbitMQ для всего остального.

### Обоснование
- **Производительность** — синхронные вызовы проще и быстрее для простых запросов.
- **Отказоустойчивость** — асинхронность позволяет переживать пиковые нагрузки и временную недоступность сервисов.
- **Слабая связанность** — сервисы не зависят от доступности друг друга напрямую.
- **Соответствует паттерну Event-Driven Architecture** — позволяет легко добавлять новые подписчики на события.

## Последствия
### Положительные
- Устойчивость к пиковым нагрузкам.
- Возможность масштабировать обработку событий независимо.
- Проще реализовать eventual consistency.

### Отрицательные / Требующие внимания
- Усложнение отладки (поток выполнения нелинейный).
- Необходимость обеспечения идемпотентности обработчиков.
- Требуется инфраструктура для очередей и мониторинга задержек.

### Примеры использования
- **Синхронно**: получение профиля, сохранение тренировки.
- **Асинхронно**: отправка уведомлений, обновление лидербордов, сбор аналитики.
# ADR-006: Централизованная аутентификация через Identity Provider

## Статус
Принято

## Контекст
Требуется обеспечить безопасный доступ к API, единый вход (SSO) с существующими приложениями компании, поддержку социальных сетей для входа. Пользовательские данные чувствительны, необходимо строгое управление доступом.

## Рассмотренные альтернативы
1. **Самописная аутентификация на базе JWT**.
2. **Использование готового Identity Provider (Keycloak, Auth0, Okta)** с поддержкой OAuth2/OpenID Connect.

## Решение
Использовать централизованный Identity Provider (Keycloak) с поддержкой OAuth2 и SSO. API Gateway проверяет JWT-токены, сервисы доверяют им.

### Обоснование
- **Безопасность** — готовые решения проверены временем, регулярно обновляются.
- **Поддержка SSO** — единый вход для всех приложений компании.
- **Управление пользователями** — интеграция с корпоративными каталогами (LDAP, Active Directory) при необходимости.
- **Соответствие стандартам** — OAuth2, OpenID Connect.
- **Снижение нагрузки на разработку** — не нужно реализовывать восстановление паролей, MFA и т.д.

Самописное решение отвергнуто из-за высоких рисков ошибок и затрат на поддержку.

## Последствия
### Положительные
- Высокий уровень безопасности.
- Готовая функциональность (социальный вход, управление сессиями).
- Возможность интеграции с существующими системами компании.

### Отрицательные / Требующие внимания
- Необходимость развёртывания и администрирования Keycloak (или затраты на облачный сервис).
- Дополнительный вызов при аутентификации (но токен кэшируется).
- Сервисы должны доверять токенам, подписанным Identity Provider.